jQuery(document).ready(function(e){var i={settings_groups:["accounts","coupon","vatnumber","vatnumber-nav","emails","vat-override","automation","download","advanced","sync","receipt"],$additional_account_table:e(".wc-billingo-plus-settings–inline-table-accounts"),$rounding_table:e(".wc-billingo-plus-settings–inline-table-rounding"),$notes_table:e(".wc-billingo-plus-settings-notes"),$vat_overrides_table:e(".wc-billingo-plus-settings-vat-overrides"),$automations_table:e(".wc-billingo-plus-settings-automations"),$advanced_table:e(".wc-billingo-plus-settings-advanced-options"),activation_nonce:"",init:function(){this.init_toggle_groups(),this.index_rounding_fields(),this.toggle_sections(),e(".wc-billingo-plus-settings-section-title").on("click",this.toggle_section),this.$rounding_table.on("click",".add-row",this.rounding_add),this.$rounding_table.on("click",".delete-row",this.rounding_remove),this.activation_nonce=e(".wc-billingo-plus-settings-sidebar").data("nonce"),e("#woocommerce_wc_billingo_pro_email").keypress(this.submit_pro_on_enter),e("#wc_billingo_plus_activate_pro").on("click",this.submit_activate_form),e("#wc_billingo_plus_deactivate_pro").on("click",this.submit_deactivate_form),e("#wc_billingo_plus_validate_pro").on("click",this.submit_validate_form);var o=e("#wc_billingo_plus_load_email_ids_nonce").data("nonce");["block_uid","bank_account","receipt_block"].forEach(function(n){var t=e("#woocommerce_wc_billingo_plus_"+n);t.length&&(t.parent().find("p.description").before('<a href="#" id="woocommerce_wc_billingo_plus_'+n+'_reload"><span class="dashicons dashicons-update"></span></a>'),t.parent().on("click","#woocommerce_wc_billingo_plus_"+n+"_reload",function(){var t=e(this);return i.refresh_field(n,t,o),!1}),t.find("option").length<1&&t.parent().find(".wc-billingo-plus-settings-error").removeClass("hidden"))}),e(".wc-billingo-plus-settings-widget-rating .button-secondary").on("click",this.hide_rate_request);["invoice","proform","deposit","void"].forEach(function(i){e("#woocommerce_wc_billingo_plus_email_attachment_"+i).parent().block({message:null,overlayCSS:{background:"#ffffff url("+wc_billingo_plus_params.loading+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}})});var n={action:"wc_billingo_plus_get_email_ids",nonce:o};e.post(ajaxurl,n,function(i){i.data.forEach(function(i){var o=e("#woocommerce_wc_billingo_plus_email_attachment_"+i.field);i.options.forEach(function(e){var i=new Option(e.label,e.id,!1,e.selected);o.append(i).trigger("change")}),o.parent().unblock()})}),this.$additional_account_table.find("tfoot a").on("click",this.add_new_account_row),this.$additional_account_table.on("click","a.delete-row",this.delete_account_row),this.$additional_account_table.on("change","select",this.change_account_select_class),this.$additional_account_table.find("tbody tr").length<1&&this.add_new_account_row();var t=["notes","vat_overrides","automations","advanced_options"];[this.$notes_table,this.$vat_overrides_table,this.$automations_table,this.$advanced_table].forEach(function(o,n){var l=t[n],a=l.slice(0,-1);a=a.replace("_","-"),o.on("change","select.condition",{group:l},i.change_x_condition),o.on("change","select.wc-billingo-plus-settings-repeat-select",function(){i.reindex_x_rows(l)}),o.on("click",".add-row",{group:l},i.add_new_x_condition_row),o.on("click",".delete-row",{group:l},i.delete_x_condition_row),o.on("change","input.condition",{group:l},i.toggle_x_condition),o.on("click",".delete-"+a,{group:l},i.delete_x_row),e(".wc-billingo-plus-settings-"+a+"-add a:not([data-disabled]").on("click",{group:l,table:o},i.add_new_x_row),o.find("ul.conditions[data-options]").each(function(){var i=e(this).data("options"),o=e(this);i.forEach(function(i){var n=e("#wc_billingo_plus_"+l+"_condition_sample_row").html();(n=e(n)).find("select.condition").val(i.category),n.find("select.comparison").val(i.comparison),n.find("select.value").removeClass("selected"),n.find('select[data-condition="'+i.category+'"]').val(i.value).addClass("selected").attr("disabled",!1),o.append(n)})}),o.find(".wc-billingo-plus-settings-"+a).length<1&&e(".wc-billingo-plus-settings-"+a+"-add a:not([data-disabled]").trigger("click"),i.reindex_x_rows(l)})},init_toggle_groups:function(){e.each(i.settings_groups,function(i,o){var n=e(".wc-billingo-plus-toggle-group-"+o),t=e(".wc-billingo-plus-toggle-group-"+o+"-item").parents("tr"),l=e(".wc-billingo-plus-toggle-group-"+o+"-item-hide").parents("tr"),a=e(".wc-billingo-plus-toggle-group-"+o+"-cell-hide"),s=n.is(":checked");"emails"==o&&e(".wc-billingo-plus-toggle-group-"+o+":checked").length&&(s=!0),s?(t.show(),l.hide(),a.hide()):(t.hide(),l.show(),a.show()),n.change(function(i){i.preventDefault();var n=e(this).is(":checked");"emails"==o&&e(".wc-billingo-plus-toggle-group-"+o+":checked").length&&(n=!0),"vatnumber"!=o||n||(e(".wc-billingo-plus-toggle-group-vatnumber-nav").attr("checked",!1),e(".wc-billingo-plus-toggle-group-vatnumber-nav-item").parents("tr").hide()),"download"!=o||n||e("#woocommerce_wc_billingo_plus_email_attachment_file").prop("checked",!1).change(),n?(t.show(),l.hide(),a.hide()):(t.hide(),l.show(),a.show())})})},rounding_add:function(){var o=e(this).closest("tbody"),n=e(this).closest("tr");return o.append(n.clone()),i.index_rounding_fields(),!1},rounding_remove:function(){return e(this).closest("tr").remove(),i.index_rounding_fields(),!1},index_rounding_fields:function(){e(".wc-billingo-plus-settings–inline-table-rounding tbody tr").each(function(i,o){e(this).find(".wc-billingo-plus-rounding-table-currency select").attr("name","wc_billingo_plus_rounding_options["+i+"][currency]"),e(this).find(".wc-billingo-plus-rounding-table-rounding select").attr("name","wc_billingo_plus_rounding_options["+i+"][rounding]")})},submit_pro_on_enter:function(i){if(13==i.which)return e("#wc_billingo_plus_activate_pro").click(),!1},submit_activate_form:function(){var o=e("#woocommerce_wc_billingo_pro_key").val(),n=e(this).parents(".wc-billingo-plus-settings-widget"),t={action:"wc_billingo_plus_license_activate",key:o,nonce:i.activation_nonce};return console.log(t),n.block({message:null,overlayCSS:{background:"#ffffff url("+wc_billingo_plus_params.loading+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}}),n.find(".wc-billingo-plus-settings-widget-pro-notice").hide(),e.post(ajaxurl,t,function(e){e.success?window.location.reload():(n.find(".wc-billingo-plus-settings-widget-pro-notice p").html(e.data.message),n.find(".wc-billingo-plus-settings-widget-pro-notice").show(),n.unblock())}),!1},submit_deactivate_form:function(){var o=e(this).parents(".wc-billingo-plus-settings-widget"),n={action:"wc_billingo_plus_license_deactivate",nonce:i.activation_nonce};return o.block({message:null,overlayCSS:{background:"#ffffff url("+wc_billingo_plus_params.loading+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}}),o.find(".notice").hide(),e.post(ajaxurl,n,function(e){e.success?window.location.reload():(o.find(".notice p").html(e.data.message),o.find(".notice").show(),o.unblock())}),!1},submit_validate_form:function(){var o=e(this).parents(".wc-billingo-plus-settings-widget"),n={action:"wc_billingo_plus_license_validate",nonce:i.activation_nonce};return o.block({message:null,overlayCSS:{background:"#ffffff url("+wc_billingo_plus_params.loading+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}}),o.find(".notice").hide(),e.post(ajaxurl,n,function(e){window.location.reload()}),!1},hide_rate_request:function(){var i=e(this).data("nonce"),o=e(this).parents(".wc-billingo-plus-settings-widget"),n={action:"wc_billingo_plus_hide_rate_request",nonce:i};o.block({message:null,overlayCSS:{background:"#ffffff url("+wc_billingo_plus_params.loading+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}}),e.post(ajaxurl,n,function(e){o.slideUp()})},toggle_section:function(){e(this).toggleClass("open");var i=[];e(".wc-billingo-plus-settings-section-title.open").each(function(){i.push(e(this).find("h3").attr("id"))}),localStorage.setItem("wc_billingo_plus_settings_open_sections_v3",JSON.stringify(i))},toggle_sections:function(){var i=JSON.parse(localStorage.getItem("wc_billingo_plus_settings_open_sections_v3"));i?i.forEach(function(i){e("#"+i).parent().addClass("open")}):(e("#woocommerce_wc_billingo_plus_section_auth").parent().addClass("open"),e("#woocommerce_wc_billingo_plus_section_invoice").parent().addClass("open")),""==e("#woocommerce_wc_billingo_plus_api_key").val()&&(e(".wc-billingo-plus-settings-section-title:not(.open)").each(function(){e(this).hide()}),e(".wc-billingo-plus-settings-widget:not(.v3-update-notice)").hide())},refresh_field:function(i,o,n){var t=o,l={action:"wc_billingo_plus_reload_"+i,nonce:n};return t.hasClass("loading")||(t.addClass("loading"),e.post(ajaxurl,l,function(o){if(t.removeClass("loading"),t.addClass("loaded"),setTimeout(function(){t.removeClass("loaded")},1e3),o.data){var n=e("#woocommerce_wc_billingo_plus_"+i),l=n.val();n.val(null).empty(),o.data.forEach(function(e){var i=new Option(e.name,e.id,!0,!0);n.append(i).trigger("change")}),n.val(l),n.trigger("change")}})),!1},add_new_account_row:function(){var o=e("#wc_billingo_plus_additional_accounts_sample_row").html();return i.$additional_account_table.find("tbody").append(o),i.reindex_account_rows(),!1},delete_account_row:function(){e(this).closest("tr").remove();return i.reindex_account_rows(),i.$additional_account_table.find("tbody tr").length<1&&i.add_new_account_row(),!1},reindex_account_rows:function(){e("#wc_billingo_plus_additional_accounts_sample_row").html();return i.$additional_account_table.find("tbody tr").each(function(i){e(this).find("input, select").each(function(){var o=e(this).data("name");o=o.replace("X",i),e(this).attr("name",o)})}),!1},change_account_select_class:function(){0===this.selectedIndex?e(this).addClass("placeholder"):e(this).removeClass("placeholder")},change_x_condition:function(i){var o=e(this).val();e(this).parent().find("select.value").removeClass("selected").prop("disabled",!0),e(this).parent().find('select.value[data-condition="'+o+'"]').addClass("selected").prop("disabled",!1)},add_new_x_condition_row:function(o){var n=e("#wc_billingo_plus_"+o.data.group+"_condition_sample_row").html();return e(this).closest("ul").append(n),i.reindex_x_rows(o.data.group),!1},delete_x_condition_row:function(o){return e(this).parent().remove(),i.reindex_x_rows(o.data.group),!1},reindex_x_rows:function(i){i=i.replace("_","-");return e(".wc-billingo-plus-settings-"+i).find(".wc-billingo-plus-settings-repeat-item").each(function(i){e(this).find("textarea, select, input").each(function(){var o=e(this).data("name");o=o.replace("X",i),e(this).attr("name",o)}),e(this).find("li").each(function(o){e(this).find("select").each(function(){var n=e(this).data("name");n=(n=n.replace("Y",o)).replace("X",i),e(this).attr("name",n)})}),e(this).find(".wc-billingo-plus-settings-repeat-select").each(function(){var i=e(this).val();if(e(this).hasClass("wc-billingo-plus-settings-advanced-option-property")){var o=e(this).parents(".wc-billingo-plus-settings-advanced-option-title").find(".wc-billingo-plus-settings-advanced-option-value");o.find("option").hide(),o.find('option[value^="'+i+'"]').show(),o.val().includes(i)||o.find('option[value^="'+i+'"]').first().prop("selected",!0)}var n=e(this).find("option:selected").text();e(this).parent().find("label span").text(n),e(this).parent().find("label span").text(n),e(this).parent().find("label i").removeClass().addClass(i)})}),!1},add_new_x_row:function(o){var n=o.data.group,t=o.data.table,l=n.slice(0,-1),a=e("#wc_billingo_plus_"+l+"_sample_row").html(),s=e("#wc_billingo_plus_"+n+"_condition_sample_row").html();return(a=e(a)).find("ul").append(s),t.append(a),i.reindex_x_rows(n),!1},toggle_x_condition:function(o){var n=o.data.group,t=e(this).is(":checked"),l=e(this).closest(".wc-billingo-plus-settings-repeat-item").find("ul.conditions");if(t){if(l.find("li").length<1){var a=e("#wc_billingo_plus_"+n+"_condition_sample_row").html();l.append(a)}l.show()}else l.hide();if("notes"==n){var s=e(this).closest(".wc-billingo-plus-settings-note").find(".wc-billingo-plus-settings-note-if-append");t?s.show():s.hide()}if("automations"==n){var d=e(this).closest(".wc-billingo-plus-settings-automation").find(".wc-billingo-plus-settings-automation-if");t?d.show():d.hide()}i.reindex_x_rows(o.data.group)},delete_x_row:function(o){return e(this).closest(".wc-billingo-plus-settings-repeat-item").remove(),i.reindex_x_rows(o.data.group),!1},add_new_vat_overrides_row:function(){var o=e("#wc_billingo_plus_vat_override_sample_row").html(),n=e("#wc_billingo_plus_vat_overrides_condition_sample_row").html();return(o=e(o)).find("ul").append(n),console.log(o),i.$vat_overrides_table.append(o),i.reindex_x_rows("vat_overrides"),!1}};e(".wc-billingo-plus-notice .wc-billingo-plus-hide-notice").on("click",function(i){i.preventDefault();var o=e(this).closest(".wc-billingo-plus-notice");if(e(o).find(".wc-billingo-plus-wait").remove(),e(o).append('<div class="wc-billingo-plus-wait"></div>'),e(".wc-billingo-plus-notice.updating").length>0){var n=e(this);return setTimeout(function(){n.triggerHandler("click")},100),!1}e(o).addClass("updating"),e.post(ajaxurl,{action:"wc_billingo_plus_hide_notice",security:e(this).data("nonce"),notice:e(this).data("notice"),remind:e(this).hasClass("remind-later")?"yes":"no"},function(){e(o).removeClass("updating"),e(o).fadeOut(100)})}),e(".wc-billingo-plus-notice .wc-billingo-plus-migrate-button").on("click",function(i){i.preventDefault();var o=e(this),n=e(this).closest(".wc-billingo-plus-notice");n.find(".wc-billingo-plus-wait").remove(),n.append('<div class="wc-billingo-plus-wait"></div>'),n.addClass("updating"),e.post(ajaxurl,{action:"wc_billingo_plus_migrate",security:e(this).data("nonce")},function(){window.location.href=o.attr("href")})});var o={prefix:"wc_billingo_plus_",prefix_id:"#wc_billingo_plus_",prefix_class:".wc-billingo-plus-",$metaboxContent:e("#wc_billingo_plus_metabox .inside"),$disabledState:e(".wc-billingo-plus-metabox-disabled"),$optionsContent:e(".wc-billingo-plus-metabox-generate-options"),$autoMsg:e(".wc-billingo-plus-metabox-auto-msg"),$generateContent:e(".wc-billingo-plus-metabox-generate"),$optionsButton:e("#wc_billingo_plus_invoice_options"),$previewButton:e("#wc_billingo_plus_invoice_preview"),$generateButton:e("#wc_billingo_plus_invoice_generate"),$generateButtonReceipt:e("#wc_billingo_plus_receipt_generate"),$receiptRowVoidNote:e(".wc-billingo-plus-metabox-receipt-void-note"),$invoiceRow:e(".wc-billingo-plus-metabox-invoices-invoice"),$receiptRow:e(".wc-billingo-plus-metabox-invoices-receipt"),$proformRow:e(".wc-billingo-plus-metabox-invoices-proform"),$depositRow:e(".wc-billingo-plus-metabox-invoices-deposit"),$draftRow:e(".wc-billingo-plus-metabox-invoices-draft"),$waybillRow:e(".wc-billingo-plus-metabox-invoices-waybill"),$offerRow:e(".wc-billingo-plus-metabox-invoices-offer"),$voidedRow:e(".wc-billingo-plus-metabox-invoices-void"),$voidedReceiptRow:e(".wc-billingo-plus-metabox-invoices-void_receipt"),$completeRow:e(".wc-billingo-plus-metabox-rows-data-complete"),$emailRow:e(".wc-billingo-plus-metabox-rows-data-email"),$voidRow:e(".wc-billingo-plus-metabox-rows-data-void"),$voidReasonRow:e(".wc-billingo-plus-metabox-rows-data-void-reason"),$messages:e(".wc-billingo-plus-metabox-messages"),$reverseReceiptButton:e("#wc_billingo_plus_reverse_receipt"),nonce:e(".wc-billingo-plus-metabox-content").data("nonce"),order:e(".wc-billingo-plus-metabox-content").data("order"),optionsTocuhed:!1,is_receipt:!1,init:function(){this.$optionsButton.on("click",this.show_options),e(this.prefix_class+"invoice-toggle").on("click",this.toggle_invoice),this.$previewButton.on("click",this.show_preview),this.$generateButton.on("click",this.generate_invoice),this.$generateButtonReceipt.on("click",this.generate_invoice),this.$completeRow.find("a").on("click",this.mark_completed),this.$emailRow.find("a").on("click",this.resend_email),this.$voidRow.find("a").on("click",this.void_invoice),this.$voidReasonRow.find("textarea").on("focus",this.void_invoice_reason_focus),this.$voidReasonRow.find("textarea").on("blur",this.void_invoice_reason_blur),this.$messages.find("a").on("click",this.hide_message),this.$reverseReceiptButton.on("click",this.reverse_receipt),this.$generateButtonReceipt.length&&(this.is_receipt=!0),e(document).on("heartbeat-tick",function(e,i){i.wc_billingo_plus_pdf_download_link_invoice&&o.$invoiceRow.find("a").attr("href")!=i.wc_billingo_plus_pdf_download_link_invoice&&(o.$invoiceRow.removeClass("pending"),o.$invoiceRow.find("a").attr("href",i.wc_billingo_plus_pdf_download_link_invoice)),i.wc_billingo_plus_pdf_download_link_void&&o.$voidedRow.find("a").attr("href")!=i.wc_billingo_plus_pdf_download_link_void&&(o.$voidedRow.removeClass("pending"),o.$voidedRow.find("a").attr("href",i.wc_billingo_plus_pdf_download_link_void)),i.wc_billingo_plus_pdf_download_link_draft&&o.$draftRow.find("a").attr("href")!=i.wc_billingo_plus_pdf_download_link_draft&&(o.$draftRow.removeClass("pending"),o.$draftRow.find("a").attr("href",i.wc_billingo_plus_pdf_download_link_draft)),i.wc_billingo_plus_pdf_download_link_proform&&o.$proformRow.find("a").attr("href")!=i.wc_billingo_plus_pdf_download_link_proform&&(o.$proformRow.removeClass("pending"),o.$proformRow.find("a").attr("href",i.wc_billingo_plus_pdf_download_link_proform)),i.wc_billingo_plus_pdf_download_link_waybill&&o.$waybillRow.find("a").attr("href")!=i.wc_billingo_plus_pdf_download_link_waybill&&(o.$waybillRow.removeClass("pending"),o.$waybillRow.find("a").attr("href",i.wc_billingo_plus_pdf_download_link_waybill)),i.wc_billingo_plus_pdf_download_link_offer&&o.$offerRow.find("a").attr("href")!=i.wc_billingo_plus_pdf_download_link_offer&&(o.$offerRow.removeClass("pending"),o.$offerRow.find("a").attr("href",i.wc_billingo_plus_pdf_download_link_offer))}),o.$optionsContent.find("input, select").change(function(){o.optionsTocuhed=!0})},loading_indicator:function(e,i){o.hide_message(),e.block({message:null,overlayCSS:{background:i+" url("+wc_billingo_plus_params.loading+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}})},show_options:function(){return o.$optionsButton.toggleClass("active"),o.$optionsContent.slideToggle(),!1},toggle_invoice:function(){var i="";if(e(this).hasClass("off")&&!(i=prompt("Számlakészítés kikapcsolása. Mi az indok?","Ehhez a rendeléshez nem kell számla.")))return!1;var n={action:o.prefix+"toggle_invoice",nonce:o.nonce,order:o.order,note:i};return o.loading_indicator(o.$metaboxContent,"#fff"),e.post(ajaxurl,n,function(e){o.$disabledState.find("span").text(i),o.$metaboxContent.unblock(),"off"==e.data.state?(o.$disabledState.slideDown(),o.$optionsContent.slideUp(),o.$autoMsg.slideUp(),o.$generateContent.slideUp(),o.$voidedRow.slideUp()):(o.$disabledState.slideUp(),o.$autoMsg.slideDown(),o.$generateContent.slideDown())}),!1},add_to_heartbeat:function(i){e(document).on("heartbeat-send",function(e,n){n.wc_billingo_plus_pdf_download=i,n.wc_billingo_plus_order_id=o.order})},generate_invoice:function(){var i=e(this),n="invoice";if(1!=confirm(i.data("question")))return!1;var t=e("#wc_billingo_plus_invoice_account").val(),l=e("#wc_billingo_plus_invoice_lang").val(),a=e("#wc_billingo_plus_invoice_doc_type").val(),s=e("#wc_billingo_plus_invoice_note").val(),d=e("#wc_billingo_plus_invoice_deadline").val(),c=e("#wc_billingo_plus_invoice_completed").val(),r=e("#wc_billingo_plus_invoice_proform").is(":checked"),_=e("#wc_billingo_plus_invoice_draft").is(":checked"),p=e("#wc_billingo_plus_invoice_deposit").is(":checked"),u=e("#wc_billingo_plus_invoice_offer").is(":checked"),g=e("#wc_billingo_plus_invoice_waybill").is(":checked");r&&(n="proform"),_&&(n="draft"),p&&(n="deposit"),u&&(n="offer"),g&&(n="waybill"),o.is_receipt&&(n="receipt");var w={action:o.prefix+"generate_invoice",nonce:o.nonce,order:o.order,account:t,lang:l,doc_type:a,note:s,deadline:d,completed:c,type:n,custom:o.optionsTocuhed};if(e("#wc_billingo_plus_invoice_paid").length){var f=e("#wc_billingo_plus_invoice_paid").is(":checked");w.paid=f}return o.loading_indicator(o.$metaboxContent,"#fff"),e.post(ajaxurl,w,function(i){if(o.$metaboxContent.unblock(),o.show_messages(i),i.data.error);else{var n=i.data.pdf&&"pending"==i.data.pdf;"invoice"==i.data.type&&(o.$autoMsg.slideUp(),o.$generateContent.slideUp(),o.$voidedRow.slideUp(),o.$invoiceRow.find("strong").text(i.data.name),o.$invoiceRow.find("a").attr("href",i.data.link),o.$invoiceRow.slideDown(),o.$completeRow.slideDown(),o.$emailRow.slideDown(),o.$voidRow.slideDown(),n&&(o.$invoiceRow.addClass("pending"),o.add_to_heartbeat("invoice")),i.data.paid&&(o.$completeRow.find("a").text(i.data.paid),o.$completeRow.find("a").addClass("completed"))),"receipt"==i.data.type&&(o.$autoMsg.slideUp(),o.$generateContent.slideUp(),o.$voidedRow.slideUp(),o.$receiptRow.find("strong").text(i.data.name),o.$receiptRow.find("a").attr("href",i.data.link),o.$receiptRow.slideDown(),o.$completeRow.slideDown(),o.$emailRow.slideDown(),o.$voidRow.slideDown(),n&&(o.$receiptRow.addClass("pending"),o.add_to_heartbeat("receipt")),i.data.paid&&(o.$completeRow.find("a").text(i.data.paid),o.$completeRow.find("a").addClass("completed"))),"proform"==i.data.type&&(e("#wc_billingo_plus_invoice_normal").prop("checked",!0),o.$optionsContent.slideUp(),o.$proformRow.find("strong").text(i.data.name),o.$proformRow.find("a").attr("href",i.data.link),o.$proformRow.slideDown(),o.$voidedRow.slideUp(),n&&(o.$proformRow.addClass("pending"),o.add_to_heartbeat("proform"))),"draft"==i.data.type&&(e("#wc_billingo_plus_invoice_normal").prop("checked",!0),o.$optionsContent.slideUp(),o.$draftRow.find("strong").text(i.data.name),o.$draftRow.find("a").attr("href",i.data.link),o.$draftRow.slideDown(),o.$voidedRow.slideUp(),n&&(o.$draftRow.addClass("pending"),o.add_to_heartbeat("draft"))),"deposit"==i.data.type&&(e("#wc_billingo_plus_invoice_normal").prop("checked",!0),o.$optionsContent.slideUp(),o.$depositRow.find("strong").text(i.data.name),o.$depositRow.find("a").attr("href",i.data.link),o.$depositRow.slideDown(),o.$voidedRow.slideUp()),"waybill"==i.data.type&&(e("#wc_billingo_plus_invoice_normal").prop("checked",!0),o.$optionsContent.slideUp(),o.$waybillRow.find("strong").text(i.data.name),o.$waybillRow.find("a").attr("href",i.data.link),o.$waybillRow.slideDown(),o.$voidedRow.slideUp(),n&&(o.$voidedRow.addClass("pending"),o.add_to_heartbeat("waybill"))),"offer"==i.data.type&&(e("#wc_billingo_plus_invoice_normal").prop("checked",!0),o.$optionsContent.slideUp(),o.$offerRow.find("strong").text(i.data.name),o.$offerRow.find("a").attr("href",i.data.link),o.$offerRow.slideDown(),o.$voidedRow.slideUp(),n&&(o.$offerRow.addClass("pending"),o.add_to_heartbeat("offer")))}}),!1},mark_completed_timeout:!1,mark_completed:function(){var i=e(this);if(i.hasClass("completed"))return!1;if(i.hasClass("confirm")){clearTimeout(o.mark_completed_timeout),o.loading_indicator(o.$completeRow,"#fff");var n={action:o.prefix+"mark_completed",nonce:o.nonce,order:o.order};e.post(ajaxurl,n,function(e){o.$completeRow.unblock(),o.show_messages(e),e.data.error?i.fadeOut(function(){i.text(i.data("trigger-value")),i.removeClass("confirm"),i.fadeIn()}):i.fadeOut(function(){i.text(e.data.completed),i.addClass("completed"),i.fadeIn(),i.removeClass("confirm")})})}else o.mark_completed_timeout=setTimeout(function(){i.fadeOut(function(){i.text(i.data("trigger-value")),i.fadeIn(),i.removeClass("confirm")})},5e3),i.addClass("confirm"),i.fadeOut(function(){i.text("Biztos?"),i.fadeIn()})},resend_email:function(){var i=e(this);o.loading_indicator(o.$emailRow,"#fff");var n={action:o.prefix+"resend_email",nonce:o.nonce,order:o.order};e.post(ajaxurl,n,function(e){o.$emailRow.unblock(),o.show_messages(e),i.fadeOut(function(){e.data.error?(i.removeClass("completed"),i.text(i.data("trigger-value")),i.fadeIn()):(i.text(i.data("done")),i.addClass("completed"),i.fadeIn(),setTimeout(function(){i.fadeOut(function(){i.removeClass("completed"),i.text(i.data("trigger-value")),i.fadeIn()})},3e3))})})},void_invoice_timeout:!1,void_invoice:function(){var i=e(this);if(i.hasClass("confirm")){clearTimeout(o.void_invoice_timeout),o.$voidReasonRow.slideUp(),o.loading_indicator(o.$voidRow,"#fff");var n=e("#wc_billingo_plus_void_note").val(),t={action:o.prefix+"void_invoice",nonce:o.nonce,order:o.order,reason:n};e.post(ajaxurl,t,function(e){if(o.$voidRow.unblock(),o.show_messages(e),e.data.error);else{var n=e.data.pdf&&"pending"==e.data.pdf;o.$invoiceRow.slideUp(),o.$proformRow.slideUp(),o.$draftRow.slideUp(),o.$completeRow.slideUp(),o.$emailRow.slideUp(),o.$voidRow.slideUp(function(){i.text(e.data.completed),i.removeClass("confirm")}),n&&(o.$voidedRow.addClass("pending"),o.add_to_heartbeat("void")),e.data.name&&(o.$voidedRow.find("strong").text(e.data.name),o.$voidedRow.find("a").attr("href",e.data.link),o.$voidedRow.slideDown()),o.$generateContent.slideDown(),o.$autoMsg.slideDown()}i.fadeOut(function(){i.text(i.data("trigger-value")),i.fadeIn(),i.removeClass("confirm")})})}else o.void_invoice_timeout=setTimeout(function(){i.fadeOut(function(){i.text(i.data("trigger-value")),i.fadeIn(),i.removeClass("confirm")}),o.$voidReasonRow.slideUp()},5e3),i.addClass("confirm"),i.fadeOut(function(){i.text(i.data("question")),i.fadeIn()}),o.$voidReasonRow.slideDown();return!1},void_invoice_reason_focus:function(){console.log("void_invoice_reason_focus"),clearTimeout(o.void_invoice_timeout)},void_invoice_reason_blur:function(){clearTimeout(o.void_invoice_timeout);var e=o.$voidRow.find("a");o.void_invoice_timeout=setTimeout(function(){e.fadeOut(function(){e.text(e.data("trigger-value")),e.fadeIn(),e.removeClass("confirm")}),o.$voidReasonRow.slideUp()},5e3)},show_messages:function(i){i.data.messages&&i.data.messages.length>0&&(this.$messages.removeClass("wc-billingo-plus-metabox-messages-success"),this.$messages.removeClass("wc-billingo-plus-metabox-messages-error"),i.data.error?this.$messages.addClass("wc-billingo-plus-metabox-messages-error"):this.$messages.addClass("wc-billingo-plus-metabox-messages-success"),$ul=this.$messages.find("ul"),$ul.html(""),e.each(i.data.messages,function(i,o){var n=e("<li>");n.append(o),$ul.append(n)}),this.$messages.slideDown())},hide_message:function(){return o.$messages.slideUp(),!1},reverse_receipt:function(){var i={action:o.prefix+"reverse_receipt",nonce:o.nonce,order:o.order};o.loading_indicator(o.$metaboxContent,"#fff"),e.post(ajaxurl,i,function(e){window.location.reload()})},show_preview:function(){var i=e("#wc_billingo_plus_invoice_note").val(),o=e("#wc_billingo_plus_invoice_deadline").val(),n=e("#wc_billingo_plus_invoice_completed").val(),t=e("#wc_billingo_plus_invoice_account").val(),l=e(this).data("url"),a={note:i,deadline:o,completed:n,account:t};return l+="&"+e.param(a),e(this).attr("href",l),!0}},n={init:function(){var i=e("#wc-billingo-plus-bulk-print");e("#wc-billingo-plus-bulk-download");i.on("click",this.printInvoices),i.length&&i.trigger("click"),e("#wpbody").on("click","#doaction",function(){return"wc_billingo_plus_bulk_grouped_generate"==e("#bulk-action-selector-top").val()?(n.show_grouped_modal(),!1):"wc_billingo_plus_bulk_generator"==e("#bulk-action-selector-top").val()?(n.show_generator_modal(),!1):void 0}),e("#wpbody").on("click","#doaction2",function(){return"wc_billingo_plus_bulk_grouped_generate"==e("#bulk-action-selector-bottom").val()?(n.show_grouped_modal(),!1):"wc_billingo_plus_bulk_generator"==e("#bulk-action-selector-top").val()?(n.show_generator_modal(),!1):void 0}),e(document).on("click","#generate_grouped_invoice",this.generate_grouped_invoices),e(document).on("click","#wc_billingo_plus_bulk_generator",this.bulk_generator),e(document).on("change",'.wc-billing-plus-modal-bulk-generator-form input[name="bulk_invoice_extra_type"]',this.toggle_bulk_generator_options);var t=!1;e(window).keydown(function(e){77==e.which&&(t=!0)}).keyup(function(e){77==e.which&&(t=!1)}),e("#wpbody").on("click","a.wc-billingo-plus-mark-paid-button",function(){if(e(this).hasClass("paid"))return!1;var i=e(this).data("order"),n=e(this).data("nonce"),l=e.datepicker.formatDate("yy-mm-dd",new Date);if(t){e(this).addClass("paid"),e(this).tipTip({content:"Fizetve: "+l}),e("#tiptip_content").text("Fizetve: "+l);var a={action:o.prefix+"mark_completed",nonce:n,order:i};e.post(ajaxurl,a,function(e){})}else e(this).WCBackboneModal({template:"wc-billingo-plus-modal-mark-paid",variable:{order_id:i}}),e("#wc_billingo_plus_mark_paid_date").datepicker({dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,maxDate:0});return!1}),e("body").on("click","#wc_billingo_plus_mark_paid",function(){var i=e(this).data("order"),n=e(this).data("nonce"),t=e("#wc_billingo_plus_mark_paid_date").val(),l={action:o.prefix+"mark_completed",nonce:n,order:i,date:t};return e('a.wc-billingo-plus-mark-paid-button[data-order="'+i+'"]').addClass("paid"),e('a.wc-billingo-plus-mark-paid-button[data-order="'+i+'"]').tipTip({content:"Fizetve: "+t}),e.post(ajaxurl,l,function(e){}),e(".modal-close-link").trigger("click"),!1}),e(".wc-billingo-plus-start-sync a").click(function(){var i=e(this).data("nonce"),n=e(this),t={action:o.prefix+"run_sync",nonce:i};return n.addClass("loading"),e.post(ajaxurl,t,function(e){n.removeClass("loading"),window.location.reload()}),!1})},printInvoices:function(){var i=e(this).data("pdf");if("function"==typeof printJS)return printJS(i),!1},show_grouped_modal:function(){var i=jQuery("#the-list input[name='post[]']:checked"),o=[],n=e("<ul/>");return n.addClass("wc-billingo-plus-modal-grouped-generate-list"),e(i).each(function(t){var l=e(i[t]).val(),a=e(i[t]).parents(".type-shop_order").find("a.order-view").text();n.append('<li><label><input type="radio" name="main_order_id" value="'+l+'"> '+a+"</label></li>"),o.push(l)}),0===i.length&&(o=!1),e(this).WCBackboneModal({template:"wc-billingo-plus-modal-grouped-generate",variable:{orders:n.prop("outerHTML"),orderIds:o}}),!1},generate_grouped_invoices:function(){var i=e(this).data("orders"),n=e(this).data("nonce"),t=e("input[name=main_order_id]:checked",".wc-billingo-plus-modal-grouped-generate-list").val();if(!t)return e(".wc-billingo-plus-modal-grouped-generate-list").addClass("validate"),setTimeout(function(){e(".wc-billingo-plus-modal-grouped-generate-list").removeClass("validate")},1e3),!1;o.loading_indicator(e(".wc-billingo-plus-modal-grouped-generate-form"),"#fff");var l={action:o.prefix+"generate_grouped_invoice",nonce:n,orders:i,main_order:t};return e.post(ajaxurl,l,function(i){e(".wc-billingo-plus-modal-grouped-generate-form").unblock(),o.show_messages(i),i.data.error||(e(".wc-billingo-plus-modal-grouped-generate-download").slideDown(),e(".wc-billingo-plus-modal-grouped-generate-download-invoice").find("strong").text(i.data.name),e(".wc-billingo-plus-modal-grouped-generate-download-invoice").attr("href",i.data.link),e(".wc-billingo-plus-modal-grouped-generate-download-order").attr("href",i.data.order_link),e(".wc-billingo-plus-modal-grouped-generate-form, .wc-billingo-plus-modal-grouped-generate footer").slideUp())}),!1},show_messages:function(i){$messages=e(".wc-billingo-plus-modal-grouped-generate-results"),i.data.messages&&i.data.messages.length>0&&($messages.removeClass("wc-billingo-plus-metabox-messages-success"),$messages.removeClass("wc-billingo-plus-metabox-messages-error"),i.data.error?$messages.addClass("wc-billingo-plus-metabox-messages-error"):$messages.addClass("wc-billingo-plus-metabox-messages-success"),$ul=$messages.find("ul"),$ul.html(""),e.each(i.data.messages,function(i,o){var n=e("<li>");n.append(o),$ul.append(n)}),$messages.slideDown())},show_generator_modal:function(){var i=jQuery("#the-list input[name='post[]']:checked"),o=[],n=e("<ul/>");return e(i).each(function(t){var l=e(i[t]).val(),a=e(i[t]).parents(".type-shop_order").find("a.order-view").text();n.append("<li>"+a+"</li>"),o.push(l)}),0===i.length&&(o=!1),e(this).WCBackboneModal({template:"wc-billingo-plus-modal-bulk-generator",variable:{orders:n.prop("outerHTML"),orderIds:o}}),e("#wc_billingo_plus_bulk_invoice_completed").datepicker({dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0}),!1},bulk_generator:function(){var i=e(this).data("orders"),t=e(this).data("nonce");o.loading_indicator(e(".wc-billingo-plus-modal-bulk-generator-form"),"#fff");var l="invoice",a=e("#wc_billingo_plus_bulk_invoice_account").val(),s=e("#wc_billingo_plus_bulk_invoice_lang").val(),d=e("#wc_billingo_plus_bulk_invoice_doc_type").val(),c=e("#wc_billingo_plus_bulk_invoice_note").val(),r=e("#wc_billingo_plus_bulk_invoice_deadline").val(),_=e("#wc_billingo_plus_bulk_invoice_completed").val(),p=e("#wc_billingo_plus_bulk_invoice_proform").is(":checked"),u=e("#wc_billingo_plus_bulk_invoice_deposit").is(":checked"),g=e("#wc_billingo_plus_bulk_invoice_void").is(":checked");p&&(l="proform"),u&&(l="deposit"),g&&(l="void");var w={action:o.prefix+"bulk_generator",nonce:t,orders:i,options:{account:a,lang:s,doc_type:d,note:c,deadline:r,completed:_,document_type:l}};return e.post(ajaxurl,w,function(i){e(".wc-billingo-plus-modal-bulk-generator-form").unblock(),n.show_messages(i,"bulk-generator-results"),i.data.error||(i.data.generated&&i.data.generated.forEach(function(i){var o="";console.log(i),o=i.error||i.link&&"proform_deleted"==i.link?'<div class="wc-billingo-plus-modal-bulk-generator-download-error"><span>'+i.order_number+"</span> <em>"+i.messages[0]+"</em></div>":'<a target="_blank" href="'+i.link+'" class="wc-billingo-plus-modal-bulk-generator-download-document document-'+l+'"><span>'+i.order_number+"</span> <strong>"+i.name+"</strong></a>",e(".wc-billingo-plus-modal-bulk-generator-download").append(o)}),e(".wc-billingo-plus-modal-bulk-generator-form, .wc-billingo-plus-modal-bulk-generator footer").slideUp(),e(".wc-billingo-plus-modal-bulk-generator-download").slideDown())}),!1},toggle_bulk_generator_options:function(){e("#wc_billingo_plus_bulk_invoice_void").is(":checked")?e(".hidden-if-void").hide():e(".hidden-if-void").show()}},t={$menu_bar_item:e("#wp-admin-bar-woo-billingo-plus-bg-generate-loading"),$link_stop:e("#woo-billingo-plus-bg-generate-stop"),$link_refresh:e("#woo-billingo-plus-bg-generate-refresh"),finished:!1,nonce:"",init:function(){this.$link_stop.on("click",this.stop),this.$link_refresh.on("click",this.reload_page),this.nonce=this.$link_stop.data("nonce");var e=this.refresh;setTimeout(e,5e3)},reload_page:function(){return location.reload(),!1},stop:function(){var i={action:o.prefix+"bg_generate_stop",nonce:t.nonce};return e.post(ajaxurl,i,function(e){t.mark_stopped()}),!1},refresh:function(){var i={action:o.prefix+"bg_generate_status",nonce:t.nonce};t.finished||e.post(ajaxurl,i,function(e){e.data.finished?t.mark_finished():setTimeout(t.refresh,5e3)})},mark_finished:function(){this.finished=!0,this.$menu_bar_item.addClass("finished")},mark_stopped:function(){this.mark_finished(),this.$menu_bar_item.addClass("stopped")}};if(e("#wc_billingo_plus_metabox").length&&o.init(),e("#woocommerce_wc_billingo_plus_section_auth").length&&i.init(),(e(".wc-billingo-plus-bulk-actions").length||e("#tmpl-wc-billingo-plus-modal-grouped-generate").length)&&n.init(),e("#wp-admin-bar-woo-billingo-plus-bg-generate-loading").length&&t.init(),window.location.search.indexOf("page=wc-admin")>-1){var l=function(e,i){jQuery(e).size()?i():setTimeout(function(){window.requestAnimationFrame(function(){l(e,i)})},100)};l(".woocommerce-quick-links__category",function(){var i=e(".woocommerce-quick-links__item").last(),o=i.parent(),n=i.clone();n.find("div").text("Woo Billingo Plus"),n.find("a").attr("href",wc_billingo_plus_params.settings_link),n.find("svg").html('<path d="M12.0343082,0 C18.6550698,0.0191048779 24.009494,5.39673067 23.9998973,12.0175125 C23.9902487,18.6382944 18.6202155,24.0003333 11.9994266,24.0000922 C5.35799889,23.9855985 -0.0142689467,18.5900518 -0.000102749027,11.9486235 C0.0283390863,5.3278955 5.41354658,-0.0189034005 12.0343082,0 Z M15.5212315,5.26059858 L9.74665195,5.26035672 C8.72090474,5.2865489 7.83672571,5.98938077 7.57980676,6.98277698 L5.89679363,13.7640884 C5.56124459,14.9610343 5.79607372,16.2458303 6.53332835,17.2466941 C7.27472842,18.1757371 8.41025143,18.7015248 9.59832787,18.6658984 L12.6085953,18.6658984 C14.8608784,18.5770482 16.792551,17.0312663 17.3730275,14.8532579 C17.6653802,13.8034253 17.4578303,12.6774471 16.8103812,11.8008468 C16.7665955,11.7461146 16.7184312,11.6941191 16.6719089,11.6426709 C17.4873396,11.0260188 18.0728851,10.1541553 18.3352185,9.16604182 C18.5995274,8.21280727 18.4103804,7.19096896 17.8223784,6.39550118 C17.257564,5.69611309 16.4151966,5.28281103 15.5212315,5.26059858 Z M16.2373358,7.6422992 C16.4417205,7.94622868 16.4951923,8.32719 16.3823759,8.67564189 C16.082346,9.69565048 15.1994368,10.4359392 14.142737,10.5535014 L14.1224861,10.5535014 L14.06447,10.5567853 L11.4220026,10.5567853 L10.9217509,12.5714752 L10.9217509,12.5807797 L14.0633754,12.5807797 C14.0890995,12.5807797 14.1142763,12.5807797 14.139453,12.5774957 C14.5542791,12.5577198 14.9549386,12.7308742 15.2247913,13.0465501 C15.4897295,13.4318303 15.5614667,13.9180267 15.4190903,14.3634053 C15.0593092,15.6402013 13.9344003,16.5520111 12.6107845,16.6397147 L9.59887519,16.6413567 C9.03345423,16.6702507 8.48693879,16.4336298 8.12110757,16.0015381 C7.76543127,15.4907287 7.66620773,14.8440579 7.85237279,14.2501098 L9.53538591,7.47153494 C9.57390076,7.38030506 9.65152685,7.31132643 9.74665195,7.28380372 L15.3796832,7.28380372 C15.7061399,7.26115359 16.0241084,7.39406322 16.2373358,7.6422992 Z"></path>'),o.append(n)})}});